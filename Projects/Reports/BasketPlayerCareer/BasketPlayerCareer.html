<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Giorgio Boi">

<title>Predicting Basket Player Career Longevity</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="BasketPlayerCareer_files/libs/clipboard/clipboard.min.js"></script>
<script src="BasketPlayerCareer_files/libs/quarto-html/quarto.js"></script>
<script src="BasketPlayerCareer_files/libs/quarto-html/popper.min.js"></script>
<script src="BasketPlayerCareer_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="BasketPlayerCareer_files/libs/quarto-html/anchor.min.js"></script>
<link href="BasketPlayerCareer_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="BasketPlayerCareer_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="BasketPlayerCareer_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="BasketPlayerCareer_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="BasketPlayerCareer_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Predicting Basket Player Career Longevity</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Giorgio Boi </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>The following report focuses on a sports context, specifically analyzing a dataset that presents various statistics regarding the performance of some basketball players. This study can be useful for basketball team managers, especially in choosing players to invest in to have a long-lived team. Speaking of longevity, the purpose of this report is to predict which players are characterized by a career that lasts at least 5 years. Statistically speaking, the goal is to predict the chances that a player has of maintaining a professional career for at least 5 years. This can lead to several benefits since players with more years in their careers tend to give consistent productivity and reliability. They can also provide valuable mentorship and leadership to younger teammates, helping to develop the next generation of players. Finally, retaining players with longer careers can be more cost-effective for teams in the long run, as they do not have to constantly replace players and rebuild chemistry. The dataset has 1340 observations and 21 variables, of which only one is qualitative and corresponding to the player’s name. The remainder focus more on various game statistics such as games played, points scored, rebounds, assists, steals, blocks and so on. These are summarized over the players’ careers rather than a specific season. The variable of interest is represented by the variable named “Target” and it exclusively takes two values: 0 if the player’s career has a duration of less than 5 years and 1 otherwise. For simplicity and convenience, players in the first category will be classified as “rookies” while the remainder will be named as “veterans”.</p>
</section>
<section id="building-the-environment" class="level1">
<h1>Building the environment</h1>
<p>Before proceeding to analyze the data, we need to load the needed libraries and obviously the dataset. Then missing values are checked and, if present, they will be removed to avoid errors during the model creation process. An important thing to do is encoding the target variable in order to make it compatible with the algorithms that will be used in the report.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>())</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Load necessary libraries</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: il pacchetto 'dplyr' è stato creato con R versione 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Caricamento pacchetto: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>I seguenti oggetti sono mascherati da 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>I seguenti oggetti sono mascherati da 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: il pacchetto 'tidyr' è stato creato con R versione 4.3.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: il pacchetto 'caret' è stato creato con R versione 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Caricamento del pacchetto richiesto: ggplot2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: il pacchetto 'ggplot2' è stato creato con R versione 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Caricamento del pacchetto richiesto: lattice</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: il pacchetto 'glmnet' è stato creato con R versione 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Caricamento del pacchetto richiesto: Matrix</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Caricamento pacchetto: 'Matrix'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>I seguenti oggetti sono mascherati da 'package:tidyr':

    expand, pack, unpack</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loaded glmnet 4.1-8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(randomForest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: il pacchetto 'randomForest' è stato creato con R versione 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>randomForest 4.7-1.1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Type rfNews() to see new features/changes/bug fixes.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Caricamento pacchetto: 'randomForest'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Il seguente oggetto è mascherato da 'package:ggplot2':

    margin</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Il seguente oggetto è mascherato da 'package:dplyr':

    combine</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rpart.plot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: il pacchetto 'rpart.plot' è stato creato con R versione 4.3.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: il pacchetto 'pROC' è stato creato con R versione 4.3.3</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Type 'citation("pROC")' for a citation.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Caricamento pacchetto: 'pROC'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>I seguenti oggetti sono mascherati da 'package:stats':

    cov, smooth, var</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(e1071)  <span class="co"># For confusionMatrix function</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: il pacchetto 'e1071' è stato creato con R versione 4.3.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the data</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"player_performance.csv"</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Check for missing values</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">na.omit</span>(data)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Encode the target variable</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Target <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data<span class="sc">$</span>Target)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Fortunately there were few missing values given of the 1340 records only 11 were removed completely. Below it will be taken a more detailed look at the dataset with the intention of analyzing possible missing values, outliers, and understanding how the variables present distribute and relate.</p>
</section>
<section id="eda" class="level1">
<h1>EDA</h1>
<p>In this section it is possible to get a complete idea of the dataset through the analyses of the variables. To begin with, it will be created a density plot for each variable present (excluding the name and target variable, of course).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(GamesPlayed<span class="sc">:</span>Turnovers) <span class="sc">%&gt;%</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(key, value) <span class="sc">%&gt;%</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">fill =</span> key)) <span class="sc">+</span> </span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>key, <span class="at">scales =</span> <span class="st">'free_x'</span>) <span class="sc">+</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Density Plot of Variables"</span>,</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Value"</span>,</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Density"</span>) <span class="sc">+</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="BasketPlayerCareer_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In some cases, e.g.&nbsp;Blocks, it can be seen that certain values are more concentrated on a particular area while in other cases, e.g.&nbsp;GamesPlayed, there is a less concentrated and more linear distribution. Since our interest is in career duration, one can divide these distributions by the value of the variable of interest.</p>
<p>Next, one is curious to see the differences between the variables by Target value to see how much difference there is between rookies and veterans.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot box</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>data <span class="sc">%&gt;%</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Target, GamesPlayed<span class="sc">:</span>Turnovers) <span class="sc">%&gt;%</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(key, value, <span class="sc">-</span>Target) <span class="sc">%&gt;%</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> key, <span class="at">y =</span> value, <span class="at">fill =</span> Target)) <span class="sc">+</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Boxplot of Variables by Target"</span>,</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Variable"</span>,</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Value"</span>) <span class="sc">+</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>, <span class="at">hjust=</span><span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="BasketPlayerCareer_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Two main features can be seen: the first concerns the possible presence of outliers while the second is the difference there is between the statistics of rookie and veteran players. In very few cases it is possible to notice that these two categories of players have a slight difference, in the remainder, we see a predominance of veterans. Returning to the point of outliers, another plot was created that could help to understand how many of these points actually could be considered as such. Compared to the boxplot, there are far fewer points considered as such. The approach chosen to handle them is to not exclude them from the dataset given the dynamic nature of basketball games can have.</p>
<p>The other elements to be analyzed in the dataset are the possible relationships that variables may have with each other. A correlation matrix will be used to better observe this.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation matrix</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(data <span class="sc">%&gt;%</span> <span class="fu">select</span>(GamesPlayed<span class="sc">:</span>Turnovers))</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>corrplot<span class="sc">::</span><span class="fu">corrplot</span>(cor_matrix, <span class="at">method =</span> <span class="st">"circle"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="BasketPlayerCareer_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Possible relationships indeed are present, as can be seen from the dark blue color circles. This matrix may be a deciding factor in choosing the mode of preparation to create the models.</p>
<p>Wanting to understand whether the dataset had some sort of fair balance between the newbies and veterans present, the following graph was created. As it shows, the dataset is characterized by a greater presence of the latter.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> Target, <span class="at">fill =</span> Target)) <span class="sc">+</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span> </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Target Distribution"</span>,</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Target"</span>,</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Count"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="BasketPlayerCareer_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="approach" class="level1">
<h1>Approach</h1>
<p>Supervised Learning is the appropriate paradigm for building the models since the nature of the business question implies making predictions based on historical and labeled data. Supervised learning is suitable when there is a clear target variable to predict, in this case, aligns with the need to classify players based on their historical performance metrics. The algorithms applied include Decision Tree, Random Forest and Logistic Regression. Logistic regression is used as a basic framework to compare the results of the other models. Additionally, the logistic regression is implemented two more times but with different variants included. The variants are represented by the regularizations of Ridge and Lasso Regression. These can reduce the variability of the dataset and penalize the least influential variables on the Target variable. The choice of putting both regularizations into the list of models is genuine, willing to compare which could better perform. The Decision Tree is chosen for its simplicity in its interpretation. The model allows one to visualize easily the decisions taken by the algorithm and to identify the most important variables. Generally, it tends to overfit the training data requiring the implementation of another model to solve this problem. For this reason, the Random Forest was chosen. It reduces the overfitting and theoretically improves the accuracy of the predictions. One more reason is its ability to manage the medium-high number of variables, a feature that the dataset has.</p>
</section>
<section id="split-data" class="level1">
<h1>Split Data</h1>
<p>Before proceeding with creating these models, there is the need to take into consideration some elements regarding the dataset, including the variables to be involved in the models, the subdivision of the dataset and the eventual transformation of the values. About the variables, it was decided to remove the names of the players since they are not relevant to the analysis, and some of the variables with a high correlation with several variables due to the possibility of finding redundancy of the information and/or multicollinearity. In more detail, the variables removed are MinutesPlayed, FieldGoalsMade and FieldGoalsAttempt, reaching 16 predictors for our target variable. The subdivision of the dataset was not fair, reaching 70% for training (1158 observations) and the remaining for testing (494 observations). Because of this choice the Cross-validation was not chosen to apply. Regarding the possible transformation of values, it is thought to apply the scale of data when needed. In this case, it is applied exclusively to the logistic regression and its two variants.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing Columns</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>Name <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>MinutesPlayed <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>FieldGoalsMade <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>FieldGoalsAttempt <span class="ot">=</span> <span class="cn">NULL</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the data</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>trainIndex <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(data<span class="sc">$</span>Target, <span class="at">p =</span> .<span class="dv">7</span>, </span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">list =</span> <span class="cn">FALSE</span>, </span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">times =</span> <span class="dv">1</span>)</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>trainData <span class="ot">&lt;-</span> data[trainIndex,]</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>testData  <span class="ot">&lt;-</span> data[<span class="sc">-</span>trainIndex,]</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot function</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>plot_roc <span class="ot">&lt;-</span> <span class="cf">function</span>(model, testData, title) {</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>  pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, testData, <span class="at">type =</span> <span class="st">"prob"</span>)</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>  roc_obj <span class="ot">&lt;-</span> <span class="fu">roc</span>(testData<span class="sc">$</span>Target, pred[,<span class="dv">2</span>])</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>  auc_value <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_obj)</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot.roc</span>(roc_obj, <span class="at">main =</span> <span class="fu">paste</span>(title, <span class="st">"</span><span class="sc">\n</span><span class="st">AUC ="</span>, <span class="fu">round</span>(auc_value, <span class="dv">3</span>)))</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="models" class="level1">
<h1>Models</h1>
<section id="decision-tree" class="level2">
<h2 class="anchored" data-anchor-id="decision-tree">Decision Tree</h2>
<p>The initial model built is the Decision Tree. The resulting tree presents a modest number of branches and leaves.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Decision Tree</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>tree_model <span class="ot">&lt;-</span> <span class="fu">rpart</span>(Target <span class="sc">~</span> ., <span class="at">data =</span> trainData, <span class="at">method =</span> <span class="st">"class"</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>tree_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(tree_model, testData, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>tree_cm <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(tree_pred, testData<span class="sc">$</span>Target)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Decision Tree Results:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Decision Tree Results:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(tree_cm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction   0   1
         0  78  44
         1  72 203
                                          
               Accuracy : 0.7078          
                 95% CI : (0.6604, 0.7521)
    No Information Rate : 0.6222          
    P-Value [Acc &gt; NIR] : 0.0002117       
                                          
                  Kappa : 0.3549          
                                          
 Mcnemar's Test P-Value : 0.0121800       
                                          
            Sensitivity : 0.5200          
            Specificity : 0.8219          
         Pos Pred Value : 0.6393          
         Neg Pred Value : 0.7382          
             Prevalence : 0.3778          
         Detection Rate : 0.1965          
   Detection Prevalence : 0.3073          
      Balanced Accuracy : 0.6709          
                                          
       'Positive' Class : 0               
                                          </code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the Decision Tree</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rpart.plot</span>(tree_model, <span class="at">main =</span> <span class="st">"Decision Tree"</span>, <span class="at">extra =</span> <span class="dv">106</span>, <span class="at">cex=</span><span class="fl">0.6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="BasketPlayerCareer_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The most noticeable thing is that it tends to predict more Class 1, or veterans, with a higher percentage too. By taking a closer look at the prediction made in the tests, it is shown how it assumes, at least half of the time, that a given observation is part of Class 1 when possibly it is not the case. This may be caused by an imbalance of classes, the possible presence of bias in the model, or, as mentioned earlier, by its behavior. To check whether it is indeed a problem derived from the model, it proceeded to construct the Random Forest.</p>
</section>
<section id="random-forest" class="level2">
<h2 class="anchored" data-anchor-id="random-forest">Random Forest</h2>
<p>Following the same procedure but repeated multiple times, the resulting model has differences from the Decision Tree. Given the complexity of showing the random forest visually, the importance of the variables for this model will be seen. The indicator used for this plot is MDA. MDA, or Mean Decrease Accuracy, is the variable that measures the direct impact of a feature on the average accuracy of the model. There is another variable that is similar to it (Mean Decrease Gini), but it is preferred to use MDA since the target variable is only of two classes and it is more predictive.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Hyperparameter Tuning</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>rf_model <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(Target <span class="sc">~</span> ., <span class="at">data =</span> trainData,</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>                               <span class="at">ntree =</span> <span class="dv">405</span>, <span class="at">mtry =</span> <span class="dv">4</span>, </span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">importance =</span> <span class="cn">TRUE</span>, </span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>                               <span class="at">nodesize =</span> <span class="dv">5</span>)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Model Evaluation</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>rf_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model, testData)</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>rf_cm <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(rf_pred, testData<span class="sc">$</span>Target)</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Random Forest Results:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Random Forest Results:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rf_cm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction   0   1
         0  82  54
         1  68 193
                                          
               Accuracy : 0.6927          
                 95% CI : (0.6447, 0.7378)
    No Information Rate : 0.6222          
    P-Value [Acc &gt; NIR] : 0.001974        
                                          
                  Kappa : 0.3342          
                                          
 Mcnemar's Test P-Value : 0.239210        
                                          
            Sensitivity : 0.5467          
            Specificity : 0.7814          
         Pos Pred Value : 0.6029          
         Neg Pred Value : 0.7395          
             Prevalence : 0.3778          
         Detection Rate : 0.2065          
   Detection Prevalence : 0.3426          
      Balanced Accuracy : 0.6640          
                                          
       'Positive' Class : 0               
                                          </code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Variable Importance for Random Forest</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">varImpPlot</span>(rf_model, <span class="at">type =</span> <span class="dv">1</span>, <span class="at">main =</span> <span class="st">"Variable Importance in Random Forest"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="BasketPlayerCareer_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The most important variable for this model is GamesPlayed as shown by its value of MDA, impacting in a significant way if its values are shuffled. The higher the value of MDA, the higher the influence of that variable. In this case, FreeThrowPercent is the least significant variable for predicting the target variable.</p>
</section>
</section>
<section id="scale-data" class="level1">
<h1>Scale Data</h1>
<p>As mentioned above, the remaining models require the data to be scaled.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scale the features</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>scaled_data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(GamesPlayed<span class="sc">:</span>Turnovers, scale))</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>trainDataScaled <span class="ot">&lt;-</span> scaled_data[trainIndex,]</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>testDataScaled  <span class="ot">&lt;-</span> scaled_data[<span class="sc">-</span>trainIndex,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="lasso-regression" class="level2">
<h2 class="anchored" data-anchor-id="lasso-regression">Lasso Regression</h2>
<p>After the trees, it is the turn to explore the models related to logistic regression. Since the unregularized version is used as framework, it will not be seen in more detail giving more space to the regularized versions of it. It started from the model with the most punitive regularization, namely Lasso.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Logistic Regression with Lasso Regularization</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>lasso_model <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(<span class="fu">as.matrix</span>(trainDataScaled[, <span class="sc">-</span><span class="fu">ncol</span>(trainDataScaled)]), trainDataScaled<span class="sc">$</span>Target, <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">alpha =</span> <span class="dv">1</span>)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>lasso_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(lasso_model, <span class="at">s =</span> <span class="st">"lambda.min"</span>, <span class="at">newx =</span> <span class="fu">as.matrix</span>(testDataScaled[, <span class="sc">-</span><span class="fu">ncol</span>(testDataScaled)]), <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>lasso_pred <span class="ot">&lt;-</span> <span class="fu">factor</span>(lasso_pred, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>lasso_cm <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(lasso_pred, testDataScaled<span class="sc">$</span>Target)</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Lasso Regression Results:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Lasso Regression Results:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(lasso_cm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction   0   1
         0  78  36
         1  72 211
                                          
               Accuracy : 0.728           
                 95% CI : (0.6813, 0.7712)
    No Information Rate : 0.6222          
    P-Value [Acc &gt; NIR] : 5.637e-06       
                                          
                  Kappa : 0.3928          
                                          
 Mcnemar's Test P-Value : 0.0007575       
                                          
            Sensitivity : 0.5200          
            Specificity : 0.8543          
         Pos Pred Value : 0.6842          
         Neg Pred Value : 0.7456          
             Prevalence : 0.3778          
         Detection Rate : 0.1965          
   Detection Prevalence : 0.2872          
      Balanced Accuracy : 0.6871          
                                          
       'Positive' Class : 0               
                                          </code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lasso_model<span class="sc">$</span>glmnet.fit, <span class="at">xvar =</span> <span class="st">"lambda"</span>, <span class="at">label =</span> <span class="cn">TRUE</span>)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="at">main =</span> <span class="st">"Coefficient Path - Lasso Regression"</span>, <span class="at">line =</span> <span class="fl">2.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="BasketPlayerCareer_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>One can analyze how much lambda is needed to bring the coefficients toward zero. In the graph, lambda is represented by a logarithmic scale to allow the behavior of the coefficients to be seen accurately. Two of these coefficients require little lambda to reach zero, making it clear how unimportant they are for predicting the target variable and thus have minimal impact on the prediction of the model. Of note, about 7 coefficients require a very high lambda value compared to the others showing how relevant they are.</p>
</section>
<section id="ridge-regression" class="level2">
<h2 class="anchored" data-anchor-id="ridge-regression">Ridge Regression</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Logistic Regression with Ridge Regularization</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>ridge_model <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(<span class="fu">as.matrix</span>(trainDataScaled[, <span class="sc">-</span><span class="fu">ncol</span>(trainDataScaled)]), trainDataScaled<span class="sc">$</span>Target, <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">alpha =</span> <span class="dv">0</span>)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>ridge_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(ridge_model, <span class="at">s =</span> <span class="st">"lambda.min"</span>, <span class="at">newx =</span> <span class="fu">as.matrix</span>(testDataScaled[, <span class="sc">-</span><span class="fu">ncol</span>(testDataScaled)]), <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>ridge_pred <span class="ot">&lt;-</span> <span class="fu">factor</span>(ridge_pred, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>ridge_cm <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(ridge_pred, testDataScaled<span class="sc">$</span>Target)</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Ridge Regression Results:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Ridge Regression Results:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ridge_cm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction   0   1
         0  82  37
         1  68 210
                                          
               Accuracy : 0.7355          
                 95% CI : (0.6892, 0.7783)
    No Information Rate : 0.6222          
    P-Value [Acc &gt; NIR] : 1.185e-06       
                                          
                  Kappa : 0.4137          
                                          
 Mcnemar's Test P-Value : 0.003415        
                                          
            Sensitivity : 0.5467          
            Specificity : 0.8502          
         Pos Pred Value : 0.6891          
         Neg Pred Value : 0.7554          
             Prevalence : 0.3778          
         Detection Rate : 0.2065          
   Detection Prevalence : 0.2997          
      Balanced Accuracy : 0.6984          
                                          
       'Positive' Class : 0               
                                          </code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ridge_model<span class="sc">$</span>glmnet.fit, <span class="at">xvar =</span> <span class="st">"lambda"</span>, <span class="at">label =</span> <span class="cn">TRUE</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="fu">title</span>(<span class="at">main =</span> <span class="st">"Coefficient Path - Ridge Regression"</span>, <span class="at">line =</span> <span class="fl">2.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="BasketPlayerCareer_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Ridge Regression has a different approach than Lasso. It does not force any variable to reach zero but, only close to it. Unlike Lasso, which removed the less relevant ones, Ridge will not perform subset selection.</p>
</section>
<section id="logistic-regression" class="level2">
<h2 class="anchored" data-anchor-id="logistic-regression">Logistic Regression</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Logistic Regression for Comparison</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>logit_model <span class="ot">&lt;-</span> <span class="fu">glm</span>(Target <span class="sc">~</span> ., <span class="at">data =</span> trainDataScaled, <span class="at">family =</span> binomial)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>logit_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(logit_model, testDataScaled, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>logit_pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(logit_pred <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>logit_pred_class <span class="ot">&lt;-</span> <span class="fu">factor</span>(logit_pred_class, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>logit_cm <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(logit_pred_class, testDataScaled<span class="sc">$</span>Target)</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Logistic Regression Results:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Logistic Regression Results:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(logit_cm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction   0   1
         0  83  39
         1  67 208
                                          
               Accuracy : 0.733           
                 95% CI : (0.6866, 0.7759)
    No Information Rate : 0.6222          
    P-Value [Acc &gt; NIR] : 2.018e-06       
                                          
                  Kappa : 0.4105          
                                          
 Mcnemar's Test P-Value : 0.008729        
                                          
            Sensitivity : 0.5533          
            Specificity : 0.8421          
         Pos Pred Value : 0.6803          
         Neg Pred Value : 0.7564          
             Prevalence : 0.3778          
         Detection Rate : 0.2091          
   Detection Prevalence : 0.3073          
      Balanced Accuracy : 0.6977          
                                          
       'Positive' Class : 0               
                                          </code></pre>
</div>
</div>
</section>
</section>
<section id="assessment-comparisons" class="level1">
<h1>Assessment &amp; Comparisons</h1>
<p>In the previous sections, it was seen how predictors were evaluated without analyzing how the performance of the models was. In this section, it will be assessed each of them to understand how reliable they are. To evaluate the performance of the models, the ROC Curve will be used since the analysis is based on a binary variable. To make comparisons between models instead, the confusion matrix containing the following parameters will be used: Accuracy, Sensitivity, Specificity, Precision, and F1_Score. The accuracy represents the proportion of all correct predictions, the sensitivity measures the ability of the model to identify positive cases, the specificity identifies the negative cases, the precision calculates the proportion of correct positive predictions and finally, the F1_Score is a balanced measure that considers precision and sensitivity. The next graph shows the different ROC Curves with the AUC (Area Under Curve) noted on the title of each curve, and it simply represents the area below the curve. A good ROC Curve would be located in the top-left corner of the graph. This translates to being very close to AUC equaling 1.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot ROC and Calculate AUC for Each Model</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>))</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ROC for Logistic Regression</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>roc_obj <span class="ot">&lt;-</span> <span class="fu">roc</span>(testData<span class="sc">$</span>Target, <span class="fu">as.numeric</span>(logit_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>auc_value <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_obj)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.roc</span>(roc_obj, <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"ROC Curve for Logistic Regression</span><span class="sc">\n</span><span class="st">AUC ="</span>, <span class="fu">round</span>(auc_value, <span class="dv">3</span>)))</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ROC for Ridge Regression</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>ridge_pred_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(ridge_model, <span class="at">s =</span> <span class="st">"lambda.min"</span>, <span class="at">newx =</span> <span class="fu">as.matrix</span>(testData[, <span class="sc">-</span><span class="fu">ncol</span>(testData)]), <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>roc_obj <span class="ot">&lt;-</span> <span class="fu">roc</span>(testData<span class="sc">$</span>Target, <span class="fu">as.numeric</span>(ridge_pred_prob))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1
Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>auc_value <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_obj)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.roc</span>(roc_obj, <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"ROC Curve for Ridge Regression</span><span class="sc">\n</span><span class="st">AUC ="</span>, <span class="fu">round</span>(auc_value, <span class="dv">3</span>)))</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ROC for Lasso Regression</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>lasso_pred_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(lasso_model, <span class="at">s =</span> <span class="st">"lambda.min"</span>, <span class="at">newx =</span> <span class="fu">as.matrix</span>(testData[, <span class="sc">-</span><span class="fu">ncol</span>(testData)]), <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>roc_obj <span class="ot">&lt;-</span> <span class="fu">roc</span>(testData<span class="sc">$</span>Target, <span class="fu">as.numeric</span>(lasso_pred_prob))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1
Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>auc_value <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_obj)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.roc</span>(roc_obj, <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"ROC Curve for Lasso Regression</span><span class="sc">\n</span><span class="st">AUC ="</span>, <span class="fu">round</span>(auc_value, <span class="dv">3</span>)))</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ROC for Decision Tree</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>tree_pred_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(tree_model, testData, <span class="at">type =</span> <span class="st">"prob"</span>)[, <span class="dv">2</span>]</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>roc_obj <span class="ot">&lt;-</span> <span class="fu">roc</span>(testData<span class="sc">$</span>Target, <span class="fu">as.numeric</span>(tree_pred_prob))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1
Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>auc_value <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_obj)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.roc</span>(roc_obj, <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"ROC Curve for Decision Tree</span><span class="sc">\n</span><span class="st">AUC ="</span>, <span class="fu">round</span>(auc_value, <span class="dv">3</span>)))</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ROC for Random Forest</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>rf_pred_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model, testData, <span class="at">type =</span> <span class="st">"prob"</span>)[, <span class="dv">2</span>]</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>roc_obj <span class="ot">&lt;-</span> <span class="fu">roc</span>(testData<span class="sc">$</span>Target, <span class="fu">as.numeric</span>(rf_pred_prob))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1
Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>auc_value <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_obj)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.roc</span>(roc_obj, <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"ROC Curve for Random Forest</span><span class="sc">\n</span><span class="st">AUC ="</span>, <span class="fu">round</span>(auc_value, <span class="dv">3</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="BasketPlayerCareer_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The results obtained from these curves alone do not demonstrate good model performance. To be completely certain that we have a solid model, the confusion matrix needs to be analyzed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model Comparison</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="fu">c</span>(<span class="st">"Decision Tree"</span>, <span class="st">"Random Forest"</span>, <span class="st">"Lasso Regression"</span>, <span class="st">"Ridge Regression"</span>, <span class="st">"Logistic Regression"</span>),</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Accuracy =</span> <span class="fu">c</span>(tree_cm<span class="sc">$</span>overall[<span class="st">'Accuracy'</span>], rf_cm<span class="sc">$</span>overall[<span class="st">'Accuracy'</span>], lasso_cm<span class="sc">$</span>overall[<span class="st">'Accuracy'</span>], ridge_cm<span class="sc">$</span>overall[<span class="st">'Accuracy'</span>], logit_cm<span class="sc">$</span>overall[<span class="st">'Accuracy'</span>]),</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Sensitivity =</span> <span class="fu">c</span>(tree_cm<span class="sc">$</span>byClass[<span class="st">'Sensitivity'</span>], rf_cm<span class="sc">$</span>byClass[<span class="st">'Sensitivity'</span>], lasso_cm<span class="sc">$</span>byClass[<span class="st">'Sensitivity'</span>], ridge_cm<span class="sc">$</span>byClass[<span class="st">'Sensitivity'</span>], logit_cm<span class="sc">$</span>byClass[<span class="st">'Sensitivity'</span>]),</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Specificity =</span> <span class="fu">c</span>(tree_cm<span class="sc">$</span>byClass[<span class="st">'Specificity'</span>], rf_cm<span class="sc">$</span>byClass[<span class="st">'Specificity'</span>], lasso_cm<span class="sc">$</span>byClass[<span class="st">'Specificity'</span>], ridge_cm<span class="sc">$</span>byClass[<span class="st">'Specificity'</span>], logit_cm<span class="sc">$</span>byClass[<span class="st">'Specificity'</span>]),</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Precision =</span> <span class="fu">c</span>(tree_cm<span class="sc">$</span>byClass[<span class="st">'Pos Pred Value'</span>], rf_cm<span class="sc">$</span>byClass[<span class="st">'Pos Pred Value'</span>], lasso_cm<span class="sc">$</span>byClass[<span class="st">'Pos Pred Value'</span>], ridge_cm<span class="sc">$</span>byClass[<span class="st">'Pos Pred Value'</span>], logit_cm<span class="sc">$</span>byClass[<span class="st">'Pos Pred Value'</span>]),</span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">F1_Score =</span> <span class="fu">c</span>(tree_cm<span class="sc">$</span>byClass[<span class="st">'F1'</span>], rf_cm<span class="sc">$</span>byClass[<span class="st">'F1'</span>], lasso_cm<span class="sc">$</span>byClass[<span class="st">'F1'</span>], ridge_cm<span class="sc">$</span>byClass[<span class="st">'F1'</span>], logit_cm<span class="sc">$</span>byClass[<span class="st">'F1'</span>])</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Model Comparison:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model Comparison:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                Model  Accuracy Sensitivity Specificity Precision  F1_Score
1       Decision Tree 0.7078086   0.5200000   0.8218623 0.6393443 0.5735294
2       Random Forest 0.6926952   0.5466667   0.7813765 0.6029412 0.5734266
3    Lasso Regression 0.7279597   0.5200000   0.8542510 0.6842105 0.5909091
4    Ridge Regression 0.7355164   0.5466667   0.8502024 0.6890756 0.6096654
5 Logistic Regression 0.7329975   0.5533333   0.8421053 0.6803279 0.6102941</code></pre>
</div>
</div>
<p>From the confusion matrix, it is possible to gain some insights. The Ridge Regression seems to be the best model due to its higher accuracy and precision with a good balance in the other metrics. Logistic regression also performs well, albeit slightly less than Ridge. One thing that may be surprising is the performance of Random Forest, which failed to outperform Decision Tree except for sensitivity.</p>
</section>
<section id="upgrade" class="level1">
<h1>Upgrade</h1>
<p>Not being satisfied with Random Forest, it was decided to find a solution that could improve it. As mentioned earlier during the Decision Tree exhibit, a possible cause of the model tending to predict class 1 more may correspond to an imbalance in the dataset. One of the possible solutions in this regard is to exploit oversampling. Oversampling is a technique used to increase the observations of a dataset by adding samples based on data already present. In this case, the dataset has only 323 observations related to class 0 and 826 to the other class.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Seleziona i campioni della classe minoritaria</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>minority_class_data <span class="ot">&lt;-</span> data[data<span class="sc">$</span>Target <span class="sc">==</span> <span class="dv">0</span>, ]</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Ripeti casualmente i campioni della classe minoritaria fino a raggiungere il numero di campioni della classe maggioritaria</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>oversampled_minority_class_data <span class="ot">&lt;-</span> minority_class_data[<span class="fu">sample</span>(<span class="fu">nrow</span>(minority_class_data), <span class="fu">sum</span>(data<span class="sc">$</span>Target <span class="sc">==</span> <span class="dv">1</span>), <span class="at">replace =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Combina i campioni della classe maggioritaria con i campioni oversampled della classe minoritaria</span></span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>oversampled_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data[data<span class="sc">$</span>Target <span class="sc">==</span> <span class="dv">1</span>, ], oversampled_minority_class_data)</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Controlla la distribuzione delle classi nel dataset oversampled</span></span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(oversampled_data<span class="sc">$</span>Target)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  0   1 
826 826 </code></pre>
</div>
</div>
<p>In order to have a balance between the two classes, 503 observations were added for class 0. After that, the same procedure as before was repeated to create the Random Forest.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Suddividi il dataset in training e test set</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>) <span class="co"># Imposta un seed per la riproducibilità</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>trainIndex <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(oversampled_data<span class="sc">$</span>Target, <span class="at">p =</span> .<span class="dv">7</span>, <span class="at">list =</span> <span class="cn">FALSE</span>, <span class="at">times =</span> <span class="dv">1</span>)</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>trainData <span class="ot">&lt;-</span> oversampled_data[trainIndex, ]</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>testData <span class="ot">&lt;-</span> oversampled_data[<span class="sc">-</span>trainIndex, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="random-forest-1" class="level2">
<h2 class="anchored" data-anchor-id="random-forest-1">Random Forest</h2>
<p>From the graph below it is already possible to see how this new Random Forest differs from the old one.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Hyperparameter Tuning</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>rf_model2 <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(Target <span class="sc">~</span> ., <span class="at">data =</span> trainData,</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>                               <span class="at">ntree =</span> <span class="dv">405</span>, <span class="at">mtry =</span> <span class="dv">4</span>, </span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>                               <span class="at">importance =</span> <span class="cn">TRUE</span>, </span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>                               <span class="at">nodesize =</span> <span class="dv">5</span>)</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Model Evaluation</span></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>rf_pred2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model, testData)</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>rf_cm2 <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(rf_pred2, testData<span class="sc">$</span>Target)</span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Random Forest Results:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Random Forest Results:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rf_cm2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction   0   1
         0 212  13
         1  35 234
                                          
               Accuracy : 0.9028          
                 95% CI : (0.8732, 0.9275)
    No Information Rate : 0.5             
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16       
                                          
                  Kappa : 0.8057          
                                          
 Mcnemar's Test P-Value : 0.002437        
                                          
            Sensitivity : 0.8583          
            Specificity : 0.9474          
         Pos Pred Value : 0.9422          
         Neg Pred Value : 0.8699          
             Prevalence : 0.5000          
         Detection Rate : 0.4291          
   Detection Prevalence : 0.4555          
      Balanced Accuracy : 0.9028          
                                          
       'Positive' Class : 0               
                                          </code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot Variable Importance for Random Forest</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="fu">varImpPlot</span>(rf_model2, <span class="at">type =</span> <span class="dv">1</span>, <span class="at">main =</span> <span class="st">"Variable Importance in Random Forest"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="BasketPlayerCareer_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The first two variables were confirmed as the two most important variables while the remaining ones changed slightly. This suggests that adding these samples of observations may have helped the model discover patterns that it could not do before.</p>
</section>
</section>
<section id="final-comparization" class="level1">
<h1>Final Comparization</h1>
<p>For more confirmation, the new ROC Curve and the confusion matrix will be analyzed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot ROC and Calculate AUC for Each Model</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ROC for Random Forest</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>rf_pred_prob2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model2, testData, <span class="at">type =</span> <span class="st">"prob"</span>)[, <span class="dv">2</span>]</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>roc_obj2 <span class="ot">&lt;-</span> <span class="fu">roc</span>(testData<span class="sc">$</span>Target, <span class="fu">as.numeric</span>(rf_pred_prob2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>auc_value2 <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_obj2)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.roc</span>(roc_obj2, <span class="at">main =</span> <span class="fu">paste</span>(<span class="st">"ROC Curve for Random Forest</span><span class="sc">\n</span><span class="st">AUC ="</span>, <span class="fu">round</span>(auc_value2, <span class="dv">3</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="BasketPlayerCareer_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The new curve shows that it is pointing more toward the top-left corner of the graph than the old curve and the AUC value has increased by 0.15 bringing a not bad result. However, the confusion matrix is still missing to be analyzed. For convenience, the confusion matrix from before will be rewritten and the metrics of this new Random Forest will be added. In this way, the actual improvements can be seen, and whether to confirm or change the selection of the best model created.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Model Comparison</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="fu">c</span>(<span class="st">"Decision Tree"</span>, <span class="st">"Random Forest (Prima)"</span>, <span class="st">"Lasso Regression"</span>, <span class="st">"Ridge Regression"</span>, <span class="st">"Logistic Regression"</span>, <span class="st">"Random Forest (Dopo)"</span>),</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Accuracy =</span> <span class="fu">c</span>(tree_cm<span class="sc">$</span>overall[<span class="st">'Accuracy'</span>], rf_cm<span class="sc">$</span>overall[<span class="st">'Accuracy'</span>], lasso_cm<span class="sc">$</span>overall[<span class="st">'Accuracy'</span>], ridge_cm<span class="sc">$</span>overall[<span class="st">'Accuracy'</span>], logit_cm<span class="sc">$</span>overall[<span class="st">'Accuracy'</span>], rf_cm2<span class="sc">$</span>overall[<span class="st">'Accuracy'</span>]),</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Sensitivity =</span> <span class="fu">c</span>(tree_cm<span class="sc">$</span>byClass[<span class="st">'Sensitivity'</span>], rf_cm<span class="sc">$</span>byClass[<span class="st">'Sensitivity'</span>], lasso_cm<span class="sc">$</span>byClass[<span class="st">'Sensitivity'</span>], ridge_cm<span class="sc">$</span>byClass[<span class="st">'Sensitivity'</span>], logit_cm<span class="sc">$</span>byClass[<span class="st">'Sensitivity'</span>], rf_cm2<span class="sc">$</span>byClass[<span class="st">'Sensitivity'</span>]),</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Specificity =</span> <span class="fu">c</span>(tree_cm<span class="sc">$</span>byClass[<span class="st">'Specificity'</span>], rf_cm<span class="sc">$</span>byClass[<span class="st">'Specificity'</span>], lasso_cm<span class="sc">$</span>byClass[<span class="st">'Specificity'</span>], ridge_cm<span class="sc">$</span>byClass[<span class="st">'Specificity'</span>], logit_cm<span class="sc">$</span>byClass[<span class="st">'Specificity'</span>], rf_cm2<span class="sc">$</span>byClass[<span class="st">'Specificity'</span>]),</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Precision =</span> <span class="fu">c</span>(tree_cm<span class="sc">$</span>byClass[<span class="st">'Pos Pred Value'</span>], rf_cm<span class="sc">$</span>byClass[<span class="st">'Pos Pred Value'</span>], lasso_cm<span class="sc">$</span>byClass[<span class="st">'Pos Pred Value'</span>], ridge_cm<span class="sc">$</span>byClass[<span class="st">'Pos Pred Value'</span>], logit_cm<span class="sc">$</span>byClass[<span class="st">'Pos Pred Value'</span>], rf_cm2<span class="sc">$</span>byClass[<span class="st">'Pos Pred Value'</span>]),</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">F1_Score =</span> <span class="fu">c</span>(tree_cm<span class="sc">$</span>byClass[<span class="st">'F1'</span>], rf_cm<span class="sc">$</span>byClass[<span class="st">'F1'</span>], lasso_cm<span class="sc">$</span>byClass[<span class="st">'F1'</span>], ridge_cm<span class="sc">$</span>byClass[<span class="st">'F1'</span>], logit_cm<span class="sc">$</span>byClass[<span class="st">'F1'</span>], rf_cm2<span class="sc">$</span>byClass[<span class="st">'F1'</span>])</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Model Comparison:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Model Comparison:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  Model  Accuracy Sensitivity Specificity Precision  F1_Score
1         Decision Tree 0.7078086   0.5200000   0.8218623 0.6393443 0.5735294
2 Random Forest (Prima) 0.6926952   0.5466667   0.7813765 0.6029412 0.5734266
3      Lasso Regression 0.7279597   0.5200000   0.8542510 0.6842105 0.5909091
4      Ridge Regression 0.7355164   0.5466667   0.8502024 0.6890756 0.6096654
5   Logistic Regression 0.7329975   0.5533333   0.8421053 0.6803279 0.6102941
6  Random Forest (Dopo) 0.9028340   0.8582996   0.9473684 0.9422222 0.8983051</code></pre>
</div>
</div>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>The Random Forest model not only surpassed the Decision Tree, but it scored impressive quantum progression in all parameters such that it was confirmed to be the best model, having outperformed the previously leading model of Ridge Regression. Returning to the context of a basketball team, it is practicable to leverage this model to confidently predict which players are likely to have a career of at least 5 years. This permits one to make data-driven decisions in talent management and resource allocation. Key player attributes identified by the model as critical to career longevity can help adjust our training programs to focus on these areas, thereby improving player development. By doing so, it is insurable that a manager can build a team with sustained performance and longevity. In the future, updating the model with new data will be essential to maintain its accuracy and relevance.</p>
</section>
<section id="reference-list" class="level1">
<h1>Reference List</h1>
<p><strong>Dataset</strong></p>
<p>• www.kaggle.com. (n.d.). Performance Prediction. [online] Available at: <a href="https://www.kaggle.com/datasets/sachinsharma1123/performance-prediction/data" class="uri">https://www.kaggle.com/datasets/sachinsharma1123/performance-prediction/data</a>.</p>
<p><strong>External Information</strong></p>
<p>• Google Cloud. (n.d.). What is Supervised Learning? [online] Available at: <a href="https://cloud.google.com/discover/what-is-supervised-learning" class="uri">https://cloud.google.com/discover/what-is-supervised-learning</a>.<br>
• Research, O. and Vretaros, A. (n.d.). OPEN ACESS Advances in Health and Exercise Comparing the career longevity of basketball players across three continents: A preliminary exploratory study. <em>Adv Health Exerc</em>, [online] 2(1), pp.1–7. Available at: <a href="https://www.turkishkinesiology.com/index.php/ahe/article/download/14/13." class="uri">https://www.turkishkinesiology.com/index.php/ahe/article/download/14/13.</a><br>
• IBM (2023). What is a Decision Tree | IBM. [online] www.ibm.com. Available at: <a href="https://www.ibm.com/topics/decision-trees" class="uri">https://www.ibm.com/topics/decision-trees</a>.<br>
• Donges, N. (2021). Random Forest: a Complete Guide for Machine Learning. [online] Built in. Available at: <a href="https://builtin.com/data-science/random-forest-algorithm" class="uri">https://builtin.com/data-science/random-forest-algorithm</a>.<br>
• Kumar, D. (2020). What is LASSO Regression Definition, Examples and Techniques. [online] GreatLearning. Available at: <a href="https://www.mygreatlearning.com/blog/understanding-of-lasso-regression/" class="uri">https://www.mygreatlearning.com/blog/understanding-of-lasso-regression/</a>.<br>
• www.andreaprovino.it. (2019). Ridge Regression. [online] Available at: <a href="https://www.andreaprovino.it/ridge-regression" class="uri">https://www.andreaprovino.it/ridge-regression</a>.<br>
• GeeksforGeeks. (2020). AUC-ROC Curve. [online] Available at: <a href="https://www.geeksforgeeks.org/auc-roc-curve/" class="uri">https://www.geeksforgeeks.org/auc-roc-curve/</a>.<br>
• Narkhede, S. (2018). Understanding Confusion Matrix. [online] Medium. Available at: <a href="https://towardsdatascience.com/understanding-confusion-matrix-a9ad42dcfd62" class="uri">https://towardsdatascience.com/understanding-confusion-matrix-a9ad42dcfd62</a>.<br>
• Editor (2022). Alcuni modi per gestire dati sbilanciati nel machine learning. [online] NetAi. Available at: <a href="https://netai.it/alcuni-modi-per-gestire-dati-sbilanciati-nel-machine-learning/#page-content" class="uri">https://netai.it/alcuni-modi-per-gestire-dati-sbilanciati-nel-machine-learning/#page-content</a>.<br>
• Martinez-Taboada, Fernando; Redondo, Jose Ignacio (2020). Variable importance plot (mean decrease accuracy and mean decrease Gini).. PLOS ONE. Figure. <a href="https://doi.org/10.1371/journal.pone.0230799.g002" class="uri">https://doi.org/10.1371/journal.pone.0230799.g002</a></p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>